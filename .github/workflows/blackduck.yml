name: Blackduck scan

on:
  push:
    branches:
      - experiment-blackduck-scanner-action

jobs:
  build:
    name: Build SPDX-builder
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v2.4.0

      - name: setup Java
        uses: actions/setup-java@v2.4.0
        with:
          java-version: '11.0.13'
          distribution: zulu

      - name: Build project
        run: ./gradlew build -x test

  BlackDuckScan:
    name: Black Duck scan
    runs-on: ubuntu-latest
    needs: [build]
#    if: startsWith(github.ref, 'refs/tags/')

    steps:
      - name: Scan project in Black Duck
        uses: philips-labs/blackduck-scanner-action@v2.0
        with:
          token: ${{ secrets.BLACKDUCK_TOKEN }}
          projectName: Technology_whitelisting
          versionPrefix: spdx-builder-test
          url: https://blackduck.philips.com/
          sourcePath: .
          extraArgs:  --detect.detector.search.continue=true --detect.wait.for.results=true  --detect.project.codelocation.unmap=true
